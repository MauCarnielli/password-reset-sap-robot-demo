<?php
	$method = $_SERVER['REQUEST_METHOD']; //Verifica qual o mщtodo da requisiчуo

	if($method == 'POST'){ 
		$requestBody = file_get_contents('php://input'); //Recebe o conteњdo em JSON da requisiчуo
		$json = json_decode($requestBody); //Decodifica de JSON para texto	
		$id = $json->queryResult->parameters->id; //Extrai apenas o ID, seguindo a estrutura de arrays que estс no texto.
		
		if($id != NULL){
			
			$orchestratorData = json_encode(array(
				'id' => $id,
				'source' => 'password-reset-sap-robot-demo'
			)); // Este щ o conteњdo do JSON da nova requisiчуo que vai ser mandada para o Orchestrator
			
			$context = stream_context_create(array(
				'http'=>array(
					'method' => 'POST', //Neste caso, mandamos uma requisiчуo do tipo POST
					'header' => 'Content-Type: application/json\r\n', //Qual o conteњdo que estс sendo mandado, no caso um JSON
					'content' => $orchestratorData //O conteњdo
				)
			)); //Este щ o contexto, ou seja, toda a informaчуo que vai ser passada pela requisiчуo
			
			$req = file_get_contents('https://my-php-tester.herokuapp.com/', FALSE, $context); //Envia a requisiчуo para o link e armazena na variсvel a resposta.
			
			$response = array(
				'fulfillmentText' => $id, //Aqui vai a mensagem que irс aparecer na conversa com o Chatbot
				'source' => 'webhook'
			);//Esta variсvel щ a resposta final, ou seja, a que vai para o DialogFlow. A resposta que o usuсrio vai obter apѓs o processo.
		}
		
		else{
			$response = array(
				'fulfillmentText' => 'ID nуo recebido',
				'source' => 'webhook'
			); //Caso o ID nуo seja alcanчado.
		}
		
		echo json_encode($response); //Codifica para JSON e manda para o DialogFlow.
		
	}
	else{
		echo 'Nуo foi recebido uma requisiчуo do tipo POST';
	}
?>